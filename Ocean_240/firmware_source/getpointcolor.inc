; ПЗУ Океан 240.2 REV 8 / Реверсинжиниринг aleksey.f.morozov@gmail.com / Лицензия GPL
; Получить цвет точки
; Выход: hl - адрес точки в видеопамяти, с - цвет для сравнения
; Выход: a - байт, флаги - результат сравнения

GetPointColor:
        ; Подключить видеопамять
        mvi    a, 1
        out    PORT_MAPPER

        ; Проверить бит в первой плоскости
        mov    a, m
        ana    b
        jnz    loc_EE48

        ; Проверить бит во второй плоскости
        inr    h
        mov    a, m
        dcr    h
        ana    b
        jnz    loc_EE57

        ; Отключить видеопамять
        mvi    a, 0
        out    PORT_MAPPER

        ; Сравнить C и цвет точки
        cmp    c
        ret

; ---------------------------------------------------------------------------

loc_EE48:
        inr    h
        mov    a, m
        dcr    h
        ana    b
        jnz    loc_EE5F

        ; Отключить видеопамять
        mvi    a, 0
        out    PORT_MAPPER

        ; Сравнить C и цвет точки
        mvi    a, 1
        cmp    c
        ret
;----------------------------------------------------------------------------

loc_EE57:
        ; Отключить видеопамять
        mvi    a, 0
        out    PORT_MAPPER

        ; Сравнить C и цвет точки
        mvi    a, 2
        cmp    c
        ret

;----------------------------------------------------------------------------

loc_EE5F:
        ; Отключить видеопамять
        mvi    a, 0
        out    PORT_MAPPER

        ; Сравнить C и цвет точки
        mvi    a, 3
        cmp    c
        ret
